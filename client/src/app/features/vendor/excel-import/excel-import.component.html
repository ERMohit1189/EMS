<div class="container">
  <h2>Excel Import / Export</h2>
  <p class="subtitle">Upload or download data with all columns.</p>

  <div class="action-cards">
    <mat-card>
      <mat-card-header>
        <mat-card-title>Download Template</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <button mat-stroked-button (click)="downloadTemplate()" class="full-width">
          <mat-icon>download</mat-icon> Download Template
        </button>
      </mat-card-content>
    </mat-card>
  </div>

  <mat-card>
    <mat-card-header>
      <mat-card-title>Upload Excel File</mat-card-title>
    </mat-card-header>
    <mat-card-content class="upload-content">
      
      <mat-form-field class="full-width">
        <mat-label>Data Type</mat-label>
        <mat-select [(ngModel)]="importType">
          <mat-option *ngFor="let type of importTypes" [value]="type.value">
            {{ type.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <div class="upload-area">
        <input #fileInput type="file" accept=".xlsx,.xls,.csv" (change)="onFileUpload($event)" hidden>
        <button mat-raised-button (click)="fileInput.click()" class="upload-button">
          <mat-icon>upload</mat-icon> Click to Upload
        </button>
      </div>

      <div *ngIf="importedData.length > 0" class="preview-section">
        <h3>Preview ({{ importedData.length }} rows, {{ columns.length }} columns)</h3>
        
        <div class="columns-display">
          <mat-chip *ngFor="let col of columns">{{ col }}</mat-chip>
        </div>

        <table mat-table [dataSource]="importedData.slice(0, 5)" class="preview-table">
          <ng-container *ngFor="let col of columns.slice(0, 5)" [matColumnDef]="col">
            <th mat-header-cell *matHeaderCellDef>{{ col }}</th>
            <td mat-cell *matCellDef="let row">{{ row[col] | slice:0:20 }}</td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="columns.slice(0, 5)"></tr>
          <tr mat-row *matRowDef="let row; columns: columns.slice(0, 5)"></tr>
        </table>

        <div class="actions">
          <button mat-button (click)="cancel()">Cancel</button>
          <button mat-raised-button color="primary" (click)="handleImport()">
            Import {{ importedData.length }} Rows
          </button>
        </div>
      </div>

    </mat-card-content>
  </mat-card>
</div>
