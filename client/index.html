<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    
    <!-- Cache Control for Development -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#059669" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="EOMS" />
    <link rel="apple-touch-icon" href="/favicon.png" />
    <link rel="manifest" href="/manifest.json" />

    <!-- Open Graph Tags -->
    <meta property="og:title" content="Enterprise Operations Management System (EOMS)" />
    <meta property="og:description" content="Enterprise Operations Management System for Vendors and Employees" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/attached_assets/logo.png" />
    
    <!-- Twitter Card Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@replit" />
    <meta name="twitter:title" content="Enterprise Operations Management System (EOMS)" />
    <meta name="twitter:description" content="Enterprise Operations Management System for Vendors and Employees" />
    <meta name="twitter:image" content="/attached_assets/logo.png" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png" />
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&family=Inter:wght@300..700&display=swap" rel="stylesheet">
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <script type="module">
      // Only register service worker in production builds; in development this can cause
      // spurious fetch failures and HMR overlay errors when the generated sw.js is not present.
      if (import.meta.env && import.meta.env.PROD && 'serviceWorker' in navigator) {
        window.addEventListener('load', async () => {
          try {
            // Clear old service workers to ensure fresh registration
            const registrations = await navigator.serviceWorker.getRegistrations();
            for (const reg of registrations) {
              // Unregister and re-register with cache-bust parameter
              await reg.unregister();
            }

            // Register with cache bust parameter
            const timestamp = new Date().getTime();
            const registration = await navigator.serviceWorker.register(`/sw.js?v=${timestamp}`, {
              scope: '/',
              updateViaCache: 'none'
            });
            console.log('Service Worker registered successfully:', registration);

            // Check for updates periodically
            setInterval(() => {
              registration.update().then(updatedReg => {
                if (updatedReg) {
                  console.log('Service Worker updated');
                }
              });
            }, 60000); // Check every minute
          } catch (error) {
            console.error('Service Worker registration failed:', error);
          }
        });
      }
    </script>
  </body>
</html>